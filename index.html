<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>砖转 专  住注转</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Use Heebo font */
        body {
            font-family: 'Heebo', sans-serif;
            background-color: #f8fafc;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d1d5db' fill-opacity='0.3'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4h-4z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            background-attachment: fixed;
            min-height: 100vh;
        }
        :root { --dark-blue: #1e3a8a; --dark-orange: #c2410c; --green: #16a34a; }
        .form-input, .form-select {
            @apply border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition duration-200 ease-in-out shadow-sm focus:bg-orange-50;
        }
        .form-checkbox, .form-radio { @apply focus:ring-orange-500 text-blue-600; }
        .form-label { @apply block text-sm font-medium text-gray-700 mb-1.5; }
        /* --- CHANGE: Increased padding (py-3) and made font bold --- */
        .btn { @apply px-7 py-3 rounded-lg font-bold text-white transition-all duration-300 ease-in-out shadow-md hover:shadow-lg transform hover:scale-105; }
        .traveler-card { @apply border border-gray-200 p-4 rounded-xl mb-4 shadow-md bg-white; }
        .result-card { @apply border border-gray-200 p-5 rounded-xl shadow-lg text-center bg-white flex flex-col justify-between transition-all duration-300 ease-in-out hover:shadow-xl hover:scale-[1.02]; }
        .result-card h3 { @apply text-xl font-semibold text-gray-800 mb-3; }
        .result-card img { @apply mx-auto mb-4 h-14 object-contain; }
        .result-card .price { @apply text-3xl font-bold text-[var(--dark-blue)] my-2; }
        .result-card .price-label { @apply text-sm text-gray-500 mt-1 mb-3; }
        .result-card .btn-details {
            background-color: var(--dark-orange);
            color: white;
            @apply w-full mt-auto btn; /* Inherits updated .btn styles */
        }
        .result-card .btn-details:hover { background-color: #ea580c; }
        .result-card .btn-cheapest {
            background-color: var(--green);
            color: white;
            @apply w-full mt-auto btn; /* Inherits updated .btn styles */
        }
        .result-card .btn-cheapest:hover { background-color: #15803d; }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        .section-header { @apply text-2xl font-semibold text-[var(--dark-blue)] border-b-2 border-orange-400 pb-3 mb-6; }
        .main-container { @apply max-w-5xl mx-auto bg-white p-8 md:p-10 rounded-xl shadow-2xl mt-6 mb-6; }
        .checkbox-row { @apply flex items-center p-3 rounded-lg hover:bg-orange-50 transition duration-200 cursor-pointer; }
        .checkbox-row input { @apply form-checkbox h-5 w-5; }
        .checkbox-row label { @apply ml-3 text-gray-800 cursor-pointer; }
        .checkbox-row label.disabled-label { @apply cursor-default text-gray-600; }
    </style>
</head>
<body class="p-4 md:p-6">
    <div class="main-container">
        <h1 class="text-3xl md:text-4xl font-bold text-center text-[var(--dark-blue)] mb-10">砖转 专  住注转 "</h1>

        <form id="insurance-form" class="space-y-8">
            <section>
                 <h2 class="section-header">驻专 住注</h2>
                 <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                   <div>
                       <label for="start-date" class="form-label">转专 爪</label>
                       <input type="date" id="start-date" name="start-date" class="form-input w-full" required>
                   </div>
                   <div>
                       <label for="end-date" class="form-label">转专 专</label>
                       <input type="date" id="end-date" name="end-date" class="form-input w-full" required>
                   </div>
                   <div>
                       <label for="destination" class="form-label">专 注 注拽专</label>
                       <select id="destination" name="destination" class="form-select w-full" required>
                           <option value="" disabled selected>专 专...</option>
                           <option value="usa">专"</option>
                           <option value="canada">拽</option>
                           <option value="asia">住</option>
                           <option value="africa">驻专拽</option>
                           <option value="central_south_america">专 专 专拽</option>
                           <option value="australia_nz">住专  </option>
                           <option value="europe">专驻</option>
                           <option value="other">专</option>
                       </select>
                   </div>
                 </div>
            </section>

            <section>
                 <h2 class="section-header">驻专 住注</h2>
                 <div class="mb-4">
                     <label for="num-travelers" class="form-label">住驻专 住注</label>
                     <select id="num-travelers" name="num-travelers" class="form-select w-28" required>
                         <option value="1" selected>1</option>
                         <option value="2">2</option>
                         <option value="3">3</option>
                         <option value="4">4</option>
                         <option value="5">5</option>
                     </select>
                 </div>
                 <div id="travelers-details" class="space-y-4"></div>
            </section>

            <section>
              <h2 class="section-header">专转 住</h2>
              <div class="space-y-3">
                  <div class="checkbox-row">
                      <input type="checkbox" id="cover-medical" name="cover-medical" checked disabled>
                      <label for="cover-medical" class="disabled-label">住 专驻 爪转 爪 ' (住 )</label>
                  </div>
                  <div class="checkbox-row">
                      <input type="checkbox" id="cover-cancellation" name="cover-cancellation">
                      <label for="cover-cancellation"> 拽爪专 住注</label>
                  </div>
                  <div class="checkbox-row">
                      <input type="checkbox" id="cover-baggage" name="cover-baggage">
                      <label for="cover-baggage"></label>
                  </div>
                  <div class="checkbox-row">
                      <input type="checkbox" id="cover-phone" name="cover-phone">
                      <label for="cover-phone">驻  / 住专驻</label>
                  </div>
                  <div class="checkbox-row">
                      <input type="checkbox" id="cover-laptop" name="cover-laptop">
                      <label for="cover-laptop">砖  / </label>
                  </div>
                  <div class="checkbox-row">
                      <input type="checkbox" id="cover-extreme-sports" name="cover-extreme-sports">
                      <label for="cover-extreme-sports">住驻专 转专</label>
                  </div>
                  <div class="checkbox-row">
                      <input type="checkbox" id="cover-winter-sports" name="cover-winter-sports">
                      <label for="cover-winter-sports">住驻专 专祝</label>
                  </div>
                  <div class="checkbox-row">
                      <input type="checkbox" id="cover-pregnancy" name="cover-pregnancy">
                      <label for="cover-pregnancy">专转 专 (注 砖注 32)</label>
                  </div>
              </div>
            </section>
        </form>

        <div id="results-area" class="mt-12 hidden">
            <h2 class="section-header text-center">砖转 专</h2>
            <div id="results-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
            <p class="text-center text-sm text-gray-600 mt-8">
                专  注专  注砖 砖转转 转 注, 砖 住注 拽, 爪 专驻 拽 砖注专 驻. 砖 爪专 拽砖专 砖专 住驻.
            </p>
        </div>
    </div>

    <div class="whatsapp-link text-center mt-6">
        <a href="https://wa.me/972502103596" target="_blank" class="inline-flex items-center justify-center space-x-2 space-x-reverse group">
            <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp Logo" class="h-6 w-6 transition-transform duration-200 group-hover:scale-110">
            <span class="text-green-600 font-semibold group-hover:text-green-700">050-2103596</span>
        </a>
    </div>

    <footer class="text-center mt-6 pb-6">
        <div class="flex items-center justify-center space-x-2 space-x-reverse">
            <img src=" 爪 驻.jpg" alt=" 爪 驻" class="h-10" onerror="this.style.display='none'; console.error('Logo image not found');">
            <p class="text-sm text-gray-600">转专  驻注 注  住  爪 驻</p>
        </div>
    </footer>

    <script>
        // --- Pricing data remains the same ---
        const pricingData = {
            'harel': {
                name: '专',
                logo: '专.jpg',
                url: 'https://digital.harel-group.co.il/travel-policy?guid=bee1d408-c6a7-410e-b4ee-ac690224bdd3&an=053162',
                basePricePerDay: [
                    { ageMin: 0, ageMax: 60, price: 2.20 }, { ageMin: 61, ageMax: 70, price: 3.30 },
                    { ageMin: 71, ageMax: 80, price: 6.55 }, { ageMin: 81, ageMax: 100, price: 11.60 }
                ],
                addons: {
                    cancellation: { type: 'perDayAgeBased', prices: [ { ageMin: 0, ageMax: 17, pricePerDay: 0.65 }, { ageMin: 18, ageMax: 40, pricePerDay: 0.70 }, { ageMin: 41, ageMax: 60, pricePerDay: 1.00 }, { ageMin: 61, ageMax: 75, pricePerDay: 1.50 }, { ageMin: 76, ageMax: 85, pricePerDay: 2.80 }, { ageMin: 86, ageMax: 120, pricePerDay: 4.20 } ], maxTripCost: 21 },
                    baggage: { type: 'perDay', value: 0.39 },
                    phone: { type: 'perDay', value: 1.60 },
                    pregnancy: { type: 'perDay', value: 5.00, note: '$10.00 专", 注  42' },
                    laptop: { type: 'perDay', value: 2.00 },
                    extreme_sports: { type: 'perDay', value: 0.50 },
                    winter_sports: { type: 'perDay', value: 9.00 }
                },
                notes: '专 注专 住注 专"  注 14  注砖 转 砖.'
            },
            'migdal': {
                name: '',
                logo: '_专_.svg.png',
                url: 'https://travel.migdal.co.il/travel/index?id=1780',
                basePricePerDay: [
                    { ageMin: 0, ageMax: 17, price: 2.01 }, { ageMin: 18, ageMax: 60, price: 2.20 },
                    { ageMin: 61, ageMax: 70, price: 4.40 }, { ageMin: 71, ageMax: 80, price: 8.70 },
                    { ageMin: 81, ageMax: 100, price: 23.90 }
                ],
                addons: {
                    cancellation: { type: 'perDayAgeBased', prices: [ { ageMin: 0, ageMax: 75, pricePerDay: 1.50 }, { ageMin: 76, ageMax: 120, pricePerDay: 2.50 } ], maxTripCost: 15 },
                    baggage: { type: 'perDay', value: 0.40 },
                    phone: { type: 'perDay', value: 1.90 },
                    pregnancy: { type: 'perDay', value: 4.00, note: '注 $200,000 住, 转拽驻 专转 60 ' },
                    laptop: { type: 'perDay', value: 0.80 },
                    extreme_sports: { type: 'perDay', value: 0.60 },
                    winter_sports: { type: 'perDay', value: 6.75 }
                },
                notes: '专 注专 住注 专"  转专. 专  住 爪 \' 转专/抓.'
            },
            'passportcard': {
                name: '驻住驻专专',
                logo: 'passportcard2.png',
                url: 'https://app.passportcard.co.il/BrokerLandingPage/index/196',
                basePricePerDay: [
                    { ageMin: 0, ageMax: 60, price: 2.70 }, { ageMin: 61, ageMax: 70, price: 4.10 },
                    { ageMin: 71, ageMax: 80, price: 16.10 }, { ageMin: 81, ageMax: 100, price: 25.30 }
                ],
                addons: {
                    cancellation: { type: 'perDay', value: 0.80, maxTripCost: 16 },
                    baggage: { type: 'perDay', value: 0.50 },
                    phone: { type: 'perDay', value: 1.60, note: '拽转 驻砖专转 住 注 $1,600 注转 $2.10 ' },
                    pregnancy: { type: 'perDay', value: 5.00, note: '注 砖注 32, 注  39' },
                    laptop: { type: 'perDay', value: 0.50, note: '拽转 驻砖专转 住 转 转专 注转  转专' },
                    extreme_sports: { type: 'perDay', value: 0.50, note: '$1.00 注 30 ' },
                    winter_sports: { type: 'perDay', value: 8.00 }
                },
                notes: '拽转 转住驻转 专  注转 住注 专爪转 专转. 专 注 30  注砖 转 砖. 专  住 爪 \' 转专/抓.'
            },
            'phoenix': {
                name: '驻拽住',
                logo: '驻拽住.png',
                url: 'https://travel.agentsfnx.co.il/travel/landing.html?fnx_ANum=uPdhVjpTWF8%3d&referrer=www.b-pensia.com',
                basePricePerDay: [
                    { ageMin: 0, ageMax: 60, price: 2.10 }, { ageMin: 61, ageMax: 70, price: 4.00 },
                    { ageMin: 71, ageMax: 80, price: 9.80 }, { ageMin: 81, ageMax: 100, price: 12.70 }
                ],
                addons: {
                    cancellation: { type: 'perDayAgeBased', prices: [ { ageMin: 0, ageMax: 60, pricePerDay: 0.70 }, { ageMin: 61, ageMax: 120, pricePerDay: 0.80 } ], maxTripCostAgeBased: [ { ageMin: 0, ageMax: 60, cap: 15 }, { ageMin: 61, ageMax: 120, cap: 24 } ] },
                    baggage: { type: 'perDay', value: 0.35 },
                    phone: { type: 'perDay', value: 1.40 },
                    pregnancy: { type: 'perDay', value: 4.50, note: '$9.00 专"/拽, 注  42' },
                    laptop: { type: 'perDay', value: 1.80 },
                    extreme_sports: { type: 'perDay', value: 0.60 },
                    winter_sports: { type: 'perDay', value: 7.50 }
                },
                notes: '专 注专 住注 专"/拽  注 30  注砖 转 砖.'
            }
        };

        // --- DOM Elements ---
        const form = document.getElementById('insurance-form');
        const numTravelersSelect = document.getElementById('num-travelers');
        const travelersDetailsDiv = document.getElementById('travelers-details');
        const startDateInput = document.getElementById('start-date');
        const endDateInput = document.getElementById('end-date');
        const destinationSelect = document.getElementById('destination');
        const resultsArea = document.getElementById('results-area');
        const resultsContainer = document.getElementById('results-container');

        // --- Functions ---
        function createTravelerInputs(index) {
            const div = document.createElement('div');
            div.classList.add('traveler-card', 'grid', 'grid-cols-1', 'md:grid-cols-12', 'gap-4', 'items-center');
            div.innerHTML = `
                <div class="md:col-span-2">
                    <label class="form-label font-semibold text-gray-600">住注 ${index + 1}</label>
                </div>
                <div class="md:col-span-5">
                    <label for="traveler-age-${index}" class="form-label"></label>
                    <input type="number" id="traveler-age-${index}" name="traveler-age-${index}" min="0" max="120" placeholder=" " class="form-input w-full traveler-age" required>
                </div>
                <div class="md:col-span-5">
                    <label class="form-label"></label>
                    <div class="flex space-x-4 space-x-reverse mt-1">
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="traveler-gender-${index}" value="male" class="form-radio traveler-gender h-4 w-4" required>
                            <span class="ml-2 text-gray-700">专</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="traveler-gender-${index}" value="female" class="form-radio traveler-gender h-4 w-4" required>
                            <span class="ml-2 text-gray-700">拽</span>
                        </label>
                    </div>
                </div>`;
            return div;
        }

        function updateTravelerInputs() {
            const numTravelers = parseInt(numTravelersSelect.value) || 0;
            travelersDetailsDiv.querySelectorAll('.traveler-card').forEach(card => card.remove());
            if (numTravelers > 0) {
                for (let i = 0; i < numTravelers; i++)
                    travelersDetailsDiv.appendChild(createTravelerInputs(i));
            }
            addInputListeners(); // Re-add listeners after updating inputs
        }

        function calculateDuration() {
            const startDate = new Date(startDateInput.value);
            const endDate = new Date(endDateInput.value);
            if (isNaN(startDate) || isNaN(endDate) || endDate < startDate) return 0;
            // +1 to include both start and end dates
            return Math.ceil(Math.abs(endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
        }

        function getBasePrice(companyKey, age) {
            const companyData = pricingData[companyKey];
            if (!companyData) return 0;
            for (const bracket of companyData.basePricePerDay) {
                if (age >= bracket.ageMin && age <= bracket.ageMax)
                    return bracket.price;
            }
            console.warn(`Base price not found for company ${companyKey}, age ${age}`);
            return 0; // Default or error price
        }

        function calculatePrices() {
            // Basic form validation check
            if (!startDateInput.value || !endDateInput.value || !destinationSelect.value) {
                 resultsArea.classList.add('hidden');
                 return;
            }

            const duration = calculateDuration();
            if (duration <= 0) {
                resultsArea.classList.add('hidden');
                return;
            }

            const numTravelers = parseInt(numTravelersSelect.value);
            const travelers = [];
            let formIsValid = true;

            // Validate traveler details
            for (let i = 0; i < numTravelers; i++) {
                const ageInput = document.getElementById(`traveler-age-${i}`);
                const genderInput = document.querySelector(`input[name="traveler-gender-${i}"]:checked`);
                ageInput?.classList.remove('border-red-500', 'focus:ring-red-500'); // Reset error style

                if (!ageInput || !genderInput || !ageInput.value || ageInput.value < 0 || ageInput.value > 120) {
                    if (ageInput && (!ageInput.value || ageInput.value < 0 || ageInput.value > 120)) {
                        ageInput.classList.add('border-red-500', 'focus:ring-red-500'); // Add error style
                    }
                     // Mark form as invalid but continue checking others
                    formIsValid = false;
                } else {
                    travelers.push({ age: parseInt(ageInput.value), gender: genderInput.value });
                }
            }

            // If any traveler detail is invalid, hide results and stop
            if (!formIsValid) {
                 resultsArea.classList.add('hidden');
                 return;
            }

            const selectedAddonsCheckboxes = {
                cancellation: document.getElementById('cover-cancellation').checked,
                baggage: document.getElementById('cover-baggage').checked,
                phone: document.getElementById('cover-phone').checked,
                laptop: document.getElementById('cover-laptop').checked,
                extreme_sports: document.getElementById('cover-extreme-sports').checked,
                winter_sports: document.getElementById('cover-winter-sports').checked,
                pregnancy: document.getElementById('cover-pregnancy').checked
            };

            const companyResults = [];

            for (const companyKey in pricingData) {
                const company = pricingData[companyKey];
                let totalCompanyPrice = 0;
                let cancellationCostForCompany = 0; // Initialize cancellation cost

                travelers.forEach(traveler => {
                    let travelerPrice = getBasePrice(companyKey, traveler.age) * duration;

                    // Calculate addon costs per traveler (excluding cancellation for now)
                    for (const addonKey in selectedAddonsCheckboxes) {
                        if (selectedAddonsCheckboxes[addonKey] && company.addons[addonKey]) {
                             // Skip pregnancy for males
                             if (addonKey === 'pregnancy' && traveler.gender !== 'female') {
                                 continue; // Skip this addon for this traveler
                             }
    
                            if (company.addons[addonKey].type === 'perDay' && addonKey !== 'cancellation') {
                                travelerPrice += (company.addons[addonKey].value * duration);
                            }
                            // Note: perDayAgeBased addons (other than cancellation) are not handled here, add logic if needed
                        }
                    }
                    totalCompanyPrice += travelerPrice;
                });

                 // Calculate cancellation cost separately based on all travelers and apply cap if needed
                 if (selectedAddonsCheckboxes.cancellation && company.addons.cancellation) {
                     let totalCancellationCostBeforeCap = 0;
                     travelers.forEach(traveler => {
                         let dailyCancellationPrice = 0;
                         const cancellationData = company.addons.cancellation;
                         if (cancellationData.type === 'perDayAgeBased' && cancellationData.prices) {
                             for (const bracket of cancellationData.prices) {
                                 if (traveler.age >= bracket.ageMin && traveler.age <= bracket.ageMax) {
                                     dailyCancellationPrice = bracket.pricePerDay;
                                     break;
                                 }
                             }
                         } else if (cancellationData.type === 'perDay' && cancellationData.value !== undefined) {
                             dailyCancellationPrice = cancellationData.value;
                         }
                         totalCancellationCostBeforeCap += dailyCancellationPrice * duration;
                     });

                     cancellationCostForCompany = totalCancellationCostBeforeCap; // Default to calculated cost

                     // Apply caps if they exist
                     if (company.addons.cancellation.maxTripCost !== undefined) {
                         cancellationCostForCompany = Math.min(totalCancellationCostBeforeCap, company.addons.cancellation.maxTripCost);
                     } else if (company.addons.cancellation.maxTripCostAgeBased) {
                         let maxAge = Math.max(...travelers.map(t => t.age));
                         let relevantCap = Infinity; // Default to no cap if age doesn't match
                         for (const capBracket of company.addons.cancellation.maxTripCostAgeBased) {
                             if (maxAge >= capBracket.ageMin && maxAge <= capBracket.ageMax) {
                                 relevantCap = capBracket.cap;
                                 break;
                             }
                         }
                         cancellationCostForCompany = Math.min(totalCancellationCostBeforeCap, relevantCap);
                     }
                     totalCompanyPrice += cancellationCostForCompany; // Add capped cancellation cost to total
                 }

                companyResults.push({
                    key: companyKey,
                    name: company.name,
                    logo: company.logo,
                    url: company.url,
                    price: totalCompanyPrice
                });
            }

            // Sort results by price (ascending)
            companyResults.sort((a, b) => a.price - b.price);

            const minPrice = companyResults.length > 0 ? companyResults[0].price : Infinity;

            resultsContainer.innerHTML = ''; // Clear previous results
            companyResults.forEach(result => {
                const isCheapest = result.price === minPrice;
                const buttonClass = isCheapest ? 'btn-cheapest' : 'btn-details';
                const resultDiv = document.createElement('div');
                resultDiv.classList.add('result-card');
                if (isCheapest) {
                    resultDiv.classList.add('border-green-500', 'border-2');
                }

                // --- CHANGE: Add specific text for PassportCard ---
                let passportCardText = '';
                if (result.key === 'passportcard') {
                    passportCardText = `
                        <p class="text-green-400 font-semibold text-sm mt-2 mb-1 flex items-center">
                            <span class="mr-1"></span> 专 注驻转
                        </p>
                        <p class="text-gray-500 text-xs mb-2">拽 1 砖专转</p>
                    `;
                }

                resultDiv.innerHTML = `
                     ${result.logo ? `<img src="${result.logo}" alt=" ${result.name}" class="mx-auto mb-3 h-12 object-contain" onerror="this.style.display='none'; this.parentElement.insertAdjacentHTML('afterbegin', '<h3 class=\'text-xl font-semibold text-gray-800 mb-3\'>${result.name}</h3>');">` : `<h3 class='text-xl font-semibold text-gray-800 mb-3'>${result.name}</h3>`}
                     <div class="flex-grow">
                         <p class="price">$${result.price.toFixed(2)}</p>
                         <p class="price-label">专 住驻 (砖注专)</p>
                         ${passportCardText}
                     </div>
                     <button class="btn ${buttonClass} text-base w-full mt-auto">驻专 专砖</button> `;
                resultsContainer.appendChild(resultDiv);

                // Add event listener for the button
                const detailsButton = resultDiv.querySelector('.btn');
                if (detailsButton && result.url) {
                    detailsButton.addEventListener('click', () => {
                        window.open(result.url, '_blank');
                    });
                }
            });

            resultsArea.classList.remove('hidden'); // Show results area
        }

         // --- Event Listeners Setup ---
         function addInputListeners() {
             // Inputs that trigger recalculation on 'change'
             const changeInputs = [
                 startDateInput, endDateInput, numTravelersSelect, destinationSelect,
                 document.getElementById('cover-cancellation'), document.getElementById('cover-baggage'),
                 document.getElementById('cover-phone'), document.getElementById('cover-laptop'),
                 document.getElementById('cover-extreme-sports'), document.getElementById('cover-winter-sports'),
                 document.getElementById('cover-pregnancy')
             ];
             changeInputs.forEach(input => {
                 if(input) {
                     // Remove existing listener before adding to prevent duplicates
                     input.removeEventListener('change', calculatePrices);
                     input.addEventListener('change', calculatePrices);
                 }
             });

             // Inputs that trigger recalculation on 'input' (for age) or 'change' (for gender)
             document.querySelectorAll('.traveler-age, .traveler-gender').forEach(input => {
                 const eventType = input.classList.contains('traveler-age') ? 'input' : 'change';
                 // Remove existing listener before adding
                 input.removeEventListener(eventType, calculatePrices);
                 input.addEventListener(eventType, calculatePrices);
             });
         }

        // --- Initial Setup ---
        const today = new Date();
        const todayString = today.toISOString().split('T')[0];
        startDateInput.setAttribute('min', todayString);
        endDateInput.setAttribute('min', todayString); // Initial min date for end date

        // Update end date min when start date changes
        startDateInput.addEventListener('change', () => {
            const startDateValue = startDateInput.value;
            if (startDateValue) {
                endDateInput.setAttribute('min', startDateValue);
                // Optional: Clear end date if it's before the new start date
                if (endDateInput.value && endDateInput.value < startDateValue) {
                    endDateInput.value = '';
                }
            } else {
                endDateInput.setAttribute('min', todayString); // Reset if start date is cleared
            }
            // No need to call calculatePrices here, the main change listener will handle it
        });

        // Initial call to setup traveler inputs based on default selection
        updateTravelerInputs();
        // Initial call to add listeners to all relevant inputs
        addInputListeners();

    </script>
</body>
</html>
